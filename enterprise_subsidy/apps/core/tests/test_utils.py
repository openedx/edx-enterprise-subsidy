"""
Test for utilities module.
"""
import hashlib

from django.test import TestCase

from enterprise_subsidy import __version__ as code_version

from ..utils import versioned_cache_key


class TestUtils(TestCase):
    """
    Tests for the utilities module.
    """
    def test_versioned_cache_key(self):
        with self.settings(CACHE_KEY_VERSION_STAMP='flapjacks'):
            self.assertEqual(
                versioned_cache_key('foo', 'bar'),
                hashlib.sha512(f'foo:bar:{code_version}:flapjacks'.encode()).hexdigest(),
            )
